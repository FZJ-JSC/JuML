#Project Name
PROJECT(JuML)

# Set minimum CMAKE version#
CMAKE_MINIMUM_REQUIRED(VERSION 2.8.11)

# Set Compiler
SET(CMAKE_CXX_COMPILER "mpicxx")

# COMPILER FLAGS
SET(CMAKE_CXX_FLAGS "-std=c++0x -lhdf5 -lz")

FIND_PACKAGE(Threads)

# DEFINE MPI TEST FUNCTION
SET(MPIEXEC "mpiexec")
SET(MPIEXEC_NUMPROC_FLAG "-np")
FUNCTION(ADD_MPI_TEST NAME TEST MPI_PROCS)
  SET(TEST_PARAMETERS ${MPIEXEC_NUMPROC_FLAG} ${MPI_PROCS} "./${TEST}")
  ADD_TEST(NAME ${TEST} COMMAND ${MPIEXEC} ${TEST_PARAMETERS})
ENDFUNCTION(ADD_MPI_TEST)

# ADD SOURCES
INCLUDE_DIRECTORIES(${PROJECT_SOURCE_DIR}/include)
ADD_SUBDIRECTORY(src)

# ADD GOOGLE TEST
FIND_PACKAGE(GTest)

IF(GTEST_FOUND)
    INCLUDE_DIRECTORIES(${GTEST_INCLUDE_DIRS})

    # ADD UNIT TESTS
    INCLUDE(CTest)
    ADD_SUBDIRECTORY(tests)
    ENABLE_TESTING()
endif(GTEST_FOUND)

#ADD DOKU IF DOXYGEN HAS BEEN FOUND
FIND_PACKAGE(Doxygen)
IF(DOXYGEN_FOUND)
  ADD_CUSTOM_TARGET(doc
    ${DOXYGEN_EXECUTABLE} ../doc/Doxyfile
    COMMENT "Generating API documentation with Doxygen" VERBATIM
  )
endif(DOXYGEN_FOUND)

